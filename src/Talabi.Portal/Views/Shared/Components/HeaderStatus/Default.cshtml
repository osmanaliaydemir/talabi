@using Talabi.Core.Enums
@using Talabi.Portal.Services
@inject ILocalizationService LocalizationService
@model BusyStatus

@{
    string GetStatusColor(BusyStatus status) => status switch
    {
        BusyStatus.Normal => "success",
        BusyStatus.Busy => "warning",
        BusyStatus.Overloaded => "danger",
        _ => "secondary"
    };

    string GetStatusIcon(BusyStatus status) => status switch
    {
        BusyStatus.Normal => "fa-check-circle",
        BusyStatus.Busy => "fa-hourglass-half",
        BusyStatus.Overloaded => "fa-ban",
        _ => "fa-circle"
    };

    string GetStatusText(BusyStatus status) => status switch
    {
        BusyStatus.Normal => LocalizationService.GetString("StatusNormal"),
        BusyStatus.Busy => LocalizationService.GetString("StatusBusy"),
        BusyStatus.Overloaded => LocalizationService.GetString("StatusOverloaded"),
        _ => status.ToString()
    };
    
    var currentColor = GetStatusColor(Model);
    var currentIcon = GetStatusIcon(Model);
    var currentText = GetStatusText(Model);
}

<div class="dropdown me-3">
    <button class="btn btn-sm btn-outline-@currentColor dropdown-toggle" type="button" id="statusDropdown" data-bs-toggle="dropdown" aria-expanded="false" title="@LocalizationService.GetString("ChangeStatus")">
        <i class="fas @currentIcon me-1"></i>
        <span class="d-none d-md-inline">@currentText</span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="statusDropdown">
        <li>
            <button class="dropdown-item" onclick="updateShopStatus(0)">
                <i class="fas fa-check-circle text-success me-2"></i> @LocalizationService.GetString("StatusNormal")
                <small class="text-muted d-block ms-4">Standard delivery time</small>
            </button>
        </li>
        <li>
            <button class="dropdown-item" onclick="updateShopStatus(1)">
                <i class="fas fa-hourglass-half text-warning me-2"></i> @LocalizationService.GetString("StatusBusy")
                <small class="text-muted d-block ms-4">+15 min delivery time</small>
            </button>
        </li>
        <li>
            <button class="dropdown-item" onclick="updateShopStatus(2)">
                <i class="fas fa-ban text-danger me-2"></i> @LocalizationService.GetString("StatusOverloaded")
                <small class="text-muted d-block ms-4">+45 min delivery time</small>
            </button>
        </li>
    </ul>
</div>

<script>
    function updateShopStatus(status) {
        $.ajax({
            url: '/Settings/UpdateBusyStatus',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(status),
            success: function(response) {
                if (response.success) {
                    location.reload(); // Reload to update UI color/text
                } else {
                    Swal.fire('Hata', response.message, 'error');
                }
            },
            error: function() {
                Swal.fire('Hata', 'Durum g√ºncellenemedi.', 'error');
            }
        });
    }
</script>
