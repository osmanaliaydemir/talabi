@model Getir.MerchantPortal.Models.LocalizationAdminViewModel
@inject ILocalizationService LocalizationService

@{
    ViewData["Title"] = LocalizationService.GetString("LocalizationAdmin");
}

<div class="page-header d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="page-title">@LocalizationService.GetString("LocalizationAdmin")</h1>
        <p class="text-muted mb-0">@LocalizationService.GetString("LocalizationAdminDescription")</p>
    </div>
    <form method="get" class="d-flex gap-2">
        <input type="text" name="searchKey" class="form-control" placeholder="@LocalizationService.GetString("SearchTranslationKey")" value="@Model.SearchKey" />
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-search"></i> @LocalizationService.GetString("Search")
        </button>
    </form>
</div>

@if (TempData["Success"] is string successMessage)
{
    <div class="alert alert-success">@successMessage</div>
}
@if (TempData["Error"] is string errorMessage)
{
    <div class="alert alert-danger">@errorMessage</div>
}

<div class="row g-4 mb-4">
    <div class="col-lg-7">
        <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">@LocalizationService.GetString("AvailableLanguages")</h5>
                <span class="badge bg-secondary-subtle text-secondary">@Model.Languages.Count</span>
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>@LocalizationService.GetString("Language")</th>
                            <th>@LocalizationService.GetString("CultureCode")</th>
                            <th>@LocalizationService.GetString("Direction")</th>
                            <th>@LocalizationService.GetString("Status")</th>
                            <th class="text-end">@LocalizationService.GetString("Actions")</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var language in Model.Languages.OrderBy(l => l.SortOrder))
                        {
                            <tr>
                                <td>
                                    <strong>@language.Name</strong>
                                    <div class="text-muted small">@language.NativeName</div>
                                </td>
                                <td>@language.CultureCode</td>
                                <td>
                                    @if (language.IsRtl)
                                    {
                                        <span class="badge bg-info-subtle text-info">@LocalizationService.GetString("RightToLeft")</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary-subtle text-secondary">@LocalizationService.GetString("LeftToRight")</span>
                                    }
                                </td>
                                <td>
                                    @if (language.IsDefault)
                                    {
                                        <span class="badge bg-success-subtle text-success">@LocalizationService.GetString("Default")</span>
                                    }
                                    else if (language.IsActive)
                                    {
                                        <span class="badge bg-primary-subtle text-primary">@LocalizationService.GetString("Active")</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-warning-subtle text-warning">@LocalizationService.GetString("Inactive")</span>
                                    }
                                </td>
                                <td class="text-end">
                                    @if (!language.IsDefault)
                                    {
                                        <form asp-action="SetDefault" method="post" class="d-inline">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="languageId" value="@language.Id" />
                                            <button type="submit" class="btn btn-sm btn-outline-primary">
                                                <i class="bi bi-star me-1"></i>@LocalizationService.GetString("SetDefault")
                                            </button>
                                        </form>
                                    }
                                    else
                                    {
                                        <span class="text-muted">@LocalizationService.GetString("CurrentDefault")</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="col-lg-5">
        <div class="card h-100">
            <div class="card-header">
                <h5 class="card-title mb-0">@LocalizationService.GetString("LanguageStatistics")</h5>
            </div>
            <div class="card-body">
                @if (Model.Statistics.Any())
                {
                    <ul class="list-group list-group-flush">
                        @foreach (var stat in Model.Statistics.OrderByDescending(s => s.CompletionPercentage))
                        {
                            <li class="list-group-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>@stat.LanguageName</strong>
                                        <div class="text-muted small">
                                            @stat.TotalTranslations @LocalizationService.GetString("TranslationsLowercase") â€¢
                                            @stat.UserCount @LocalizationService.GetString("UsersLowercase")
                                        </div>
                                    </div>
                                    <span class="badge bg-success-subtle text-success">@stat.CompletionPercentage.ToString("F1")%</span>
                                </div>
                                <div class="progress mt-2" style="height: 6px;">
                                    <div class="progress-bar" role="progressbar"
                                         style="width: @Math.Min(100, Math.Max(0, stat.CompletionPercentage))%">
                                    </div>
                                </div>
                            </li>
                        }
                    </ul>
                }
                else
                {
                    <p class="text-muted mb-0">@LocalizationService.GetString("NoLanguageStatistics")</p>
                }
            </div>
        </div>
    </div>
</div>

@if (Model.TranslationSearch != null)
{
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">@LocalizationService.GetString("TranslationResults")</h5>
            <span class="text-muted">
                @Model.TranslationSearch.TotalCount
            </span>
        </div>
        <div class="table-responsive">
            <table class="table table-striped mb-0">
                <thead>
                    <tr>
                        <th>@LocalizationService.GetString("Key")</th>
                        <th>@LocalizationService.GetString("Value")</th>
                        <th>@LocalizationService.GetString("Language")</th>
                        <th>@LocalizationService.GetString("Category")</th>
                        <th>@LocalizationService.GetString("Status")</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.TranslationSearch.Translations.Any())
                    {
                        foreach (var item in Model.TranslationSearch.Translations)
                        {
                            <tr>
                                <td><code>@item.Key</code></td>
                                <td>@item.Value</td>
                                <td>@item.LanguageCode</td>
                                <td>@(string.IsNullOrEmpty(item.Category) ? "-" : item.Category)</td>
                                <td>
                                    @if (item.IsActive)
                                    {
                                        <span class="badge bg-success-subtle text-success">@LocalizationService.GetString("Active")</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-warning-subtle text-warning">@LocalizationService.GetString("Inactive")</span>
                                    }
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5" class="text-center text-muted py-3">
                                @LocalizationService.GetString("NoTranslationsFound")
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}

