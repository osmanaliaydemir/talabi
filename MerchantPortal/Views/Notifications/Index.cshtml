
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h3 class="mb-1">
            <i class="fas fa-bell me-2"></i>@LocalizationService.GetString("Notifications")
        </h3>
        <p class="text-muted mb-0">
            @(Model.TotalCount) @LocalizationService.GetString("Items")
            â€¢ @LocalizationService.GetString("Page") @Model.Page / @Model.TotalPages
        </p>
    </div>
    <div class="d-flex gap-2">
        <form asp-action="MarkAsRead" method="post" class="d-inline">
            @Html.AntiForgeryToken()
            @foreach (var unread in Model.Items.Where(x => !x.IsRead))
            {
                <input type="hidden" name="ids" value="@unread.Id" />
            }
            <button type="submit" class="btn btn-outline-primary" @(Model.Items.All(x => x.IsRead) ? "disabled" : null)>
                <i class="fas fa-check me-1"></i>@LocalizationService.GetString("MarkAllRead")
            </button>
        </form>
        <a asp-action="Preferences" class="btn btn-outline-secondary">
            <i class="fas fa-sliders-h me-1"></i>@LocalizationService.GetString("Preferences")
        </a>
    </div>
</div>

@if (Model.Items.Any())
{
    <div class="timeline">
        @foreach (var notification in Model.Items.OrderByDescending(n => n.CreatedAt))
        {
            var badgeClass = notification.Type switch
            {
                "System" => "bg-primary",
                "Order" => "bg-success",
                "Stock" => "bg-warning text-dark",
                _ => "bg-secondary"
            };

            <div class="timeline-item @(notification.IsRead ? "read" : "unread")">
                <div class="timeline-marker"></div>
                <div class="timeline-content card shadow-sm mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <div class="d-flex align-items-center gap-2">
                                    <span class="badge @badgeClass">@notification.Type</span>
                                    @if (!notification.IsRead)
                                    {
                                        <span class="badge bg-warning text-dark">@LocalizationService.GetString("Unread")</span>
                                    }
                                </div>
                                <h5 class="mb-1">@notification.Title</h5>
                                <p class="mb-2 text-muted">@notification.Message</p>
                            </div>
                            <small class="text-muted">
                                <i class="far fa-clock me-1"></i>@notification.CreatedAt.ToLocalTime().ToString("dd MMM yyyy HH:mm")
                            </small>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(notification.ActionUrl))
                        {
                            <a href="@notification.ActionUrl" class="btn btn-sm btn-outline-primary" target="_blank">
                                <i class="fas fa-external-link-alt me-1"></i>@LocalizationService.GetString("Details")
                            </a>
                        }
                        @if (!notification.IsRead)
                        {
                            <form asp-action="MarkAsRead" method="post" class="d-inline ms-2">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="ids" value="@notification.Id" />
                                <button type="submit" class="btn btn-sm btn-outline-success">
                                    <i class="fas fa-check me-1"></i>@LocalizationService.GetString("MarkRead")
                                </button>
                            </form>
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    <div class="d-flex justify-content-between align-items-center mt-3">
        <div>
            @LocalizationService.GetString("Page") @Model.Page / @Model.TotalPages
        </div>
        <div class="btn-group">
            @if (Model.Page > 1)
            {
                <a asp-action="Index" asp-route-page="@(Model.Page - 1)" class="btn btn-outline-secondary">
                    <i class="fas fa-chevron-left"></i>
                </a>
            }
            else
            {
                <button class="btn btn-outline-secondary" disabled>
                    <i class="fas fa-chevron-left"></i>
                </button>
            }
            @if (Model.Page < Model.TotalPages)
            {
                <a asp-action="Index" asp-route-page="@(Model.Page + 1)" class="btn btn-outline-secondary">
                    <i class="fas fa-chevron-right"></i>
                </a>
            }
            else
            {
                <button class="btn btn-outline-secondary" disabled>
                    <i class="fas fa-chevron-right"></i>
                </button>
            }
        </div>
    </div>
}
else
{
    <div class="alert alert-info">@LocalizationService.GetString("NoData")</div>
}

<style>
    .timeline {
        position: relative;
        margin-left: 1rem;
        padding-left: 1.5rem;
        border-left: 2px solid #e9ecef;
    }
    .timeline-item {
        position: relative;
    }
    .timeline-marker {
        position: absolute;
        left: -1.1rem;
        top: 1rem;
        width: 12px;
        height: 12px;
        background-color: #6c757d;
        border-radius: 50%;
    }
    .timeline-item.unread .timeline-marker {
        background-color: #0d6efd;
        box-shadow: 0 0 0 4px rgba(13,110,253,.15);
    }
    .timeline-item.read .timeline-marker {
        background-color: #adb5bd;
    }
</style>
@inject ILocalizationService LocalizationService
@model Getir.MerchantPortal.Models.PagedResult<Getir.MerchantPortal.Models.NotificationResponse>

